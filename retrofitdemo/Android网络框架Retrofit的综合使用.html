<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Android网络框架Retrofit的综合使用</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="qaw0" id="android网络框架retrofit的综合使用">Android网络框架Retrofit的综合使用</h1><p data-anchor-id="teqr"><code>未分类</code></p><hr><p data-anchor-id="t6ry">一．Retrofit的相关介绍</p><blockquote data-anchor-id="dci8" class="white-blockquote">
  <p>Retrofit和OkHttp师出同门，也是Square的开源库，它是一个类型安全的网络请求库，Retrofit简化了网络请求流程，基于OkHtttp做了封装，解耦的更彻底。  <br>
  相关连接：  <br>
  官网： <a href="http://square.github.io/retrofit/" target="_blank">http://square.github.io/retrofit/</a>  <br>
  github：<a href="https://github.com/square/retrofit" target="_blank">https://github.com/square/retrofit</a>  <br>
       但是Retrofit使用的话一般是结合其他框架综合使用达到非常方便获取数数据的效果。  <br>
       之前在很多网站看到过一些知识点，但是对于第一次接触Retrofit的人还是比较困惑，并且它们提供的资料好多都不能完整运行出效果。  <br>
       这里演示使用GET和POST的方式请求数据，这个网站是我之前专门练习网络请求的一个服务端，现在还可以访问。 <br>
       请求的网址基地址：<a href="http://118.192.147.148/Matchbox/" target="_blank">http://118.192.147.148/Matchbox/</a>  <br>
  数据请求时的连接地址：<a href="http://118.192.147.148/Matchbox/useruserlogin?name=13666666666&amp;password=666666" target="_blank">http://118.192.147.148/Matchbox/useruserlogin?name=13666666666&amp;password=666666</a>  <br>
       这个地址在服务器里面支持GET请求和POST请求，正常网址的服务器登陆肯定是不支持GET请求的，这里只是为了达到实验效果才特意进行设置的。</p>
</blockquote><p data-anchor-id="e5vb">下面是实际操作的步骤：</p><ol data-anchor-id="mx45">
<li>（一）添加依赖，这里依赖是比较多一点的</li>
</ol><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="bwj9"><ol class="linenums"><li class="L0"><code><span class="pln">compile </span><span class="str">'com.google.code.gson:gson:2.8.0'</span></code></li><li class="L1"><code><span class="pln">compile </span><span class="str">'com.squareup.retrofit2:retrofit:2.1.0'</span></code></li><li class="L2"><code><span class="pln">compile </span><span class="str">'com.squareup.okhttp3:okhttp:3.4.2'</span></code></li><li class="L3"><code><span class="pln">compile </span><span class="str">'com.squareup.retrofit2:converter-gson:2.1.0'</span></code></li><li class="L4"><code><span class="pln">compile </span><span class="str">'com.squareup.retrofit2:converter-scalars:2.0.0'</span></code></li></ol></pre><p data-anchor-id="6oez">这里导入了gson解析，获得的对象可以很方便的拿到json字符串数据中的某个数据，并且没有什么步骤</p><ol data-anchor-id="qd4y">
<li>（二）添加权限</li>
</ol><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="jwjj"><ol class="linenums"><li class="L0"><code><span class="tag">&lt;uses-permission</span><span class="pln"> </span><span class="atn">android:name</span><span class="pun">=</span><span class="atv">"android.permission.INTERNET"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L1"><code><span class="tag">&lt;uses-permission</span><span class="pln"> </span><span class="atn">android:name</span><span class="pun">=</span><span class="atv">"android.permission.WRITE_EXTERNAL_STORAGE"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li></ol></pre><ol data-anchor-id="bmx1">
<li>（三）布局文件的设计</li>
</ol><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="218e"><ol class="linenums"><li class="L0"><code><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"utf-8"</span><span class="pun">?&gt;</span></code></li><li class="L1"><code><span class="tag">&lt;LinearLayout</span><span class="pln"> </span><span class="atn">xmlns:android</span><span class="pun">=</span><span class="atv">"http://schemas.android.com/apk/res/android"</span></code></li><li class="L2"><code><span class="pln">    </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"match_parent"</span></code></li><li class="L3"><code><span class="pln">    </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"match_parent"</span></code></li><li class="L4"><code><span class="pln">    </span><span class="atn">android:orientation</span><span class="pun">=</span><span class="atv">"vertical"</span><span class="tag">&gt;</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="tag">&lt;TextView</span></code></li><li class="L8"><code><span class="pln">        </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L9"><code><span class="pln">        </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L0"><code><span class="pln">        </span><span class="atn">android:text</span><span class="pun">=</span><span class="atv">"Retrofit的简单使用"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="tag">&lt;Button</span></code></li><li class="L3"><code><span class="pln">        </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L4"><code><span class="pln">        </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L5"><code><span class="pln">        </span><span class="atn">android:onClick</span><span class="pun">=</span><span class="atv">"btn1"</span></code></li><li class="L6"><code><span class="pln">        </span><span class="atn">android:text</span><span class="pun">=</span><span class="atv">"btn1"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="tag">&lt;Button</span></code></li><li class="L9"><code><span class="pln">        </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L0"><code><span class="pln">        </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L1"><code><span class="pln">        </span><span class="atn">android:onClick</span><span class="pun">=</span><span class="atv">"btn2"</span></code></li><li class="L2"><code><span class="pln">        </span><span class="atn">android:text</span><span class="pun">=</span><span class="atv">"btn2"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="tag">&lt;Button</span></code></li><li class="L5"><code><span class="pln">        </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L6"><code><span class="pln">        </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L7"><code><span class="pln">        </span><span class="atn">android:onClick</span><span class="pun">=</span><span class="atv">"btn3"</span></code></li><li class="L8"><code><span class="pln">        </span><span class="atn">android:text</span><span class="pun">=</span><span class="atv">"btn3"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="tag">&lt;TextView</span></code></li><li class="L1"><code><span class="pln">        </span><span class="atn">android:id</span><span class="pun">=</span><span class="atv">"@+id/tv"</span></code></li><li class="L2"><code><span class="pln">        </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L3"><code><span class="pln">        </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L4"><code><span class="pln">        </span><span class="atn">android:text</span><span class="pun">=</span><span class="atv">"网络请求的到的数据"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="tag">&lt;/LinearLayout&gt;</span></code></li></ol></pre><p data-anchor-id="k3fx">这里设计三个按钮和一个文本，第一个按钮使用get方式请求网络数据，第二个按钮使用post方式请求网络数据，第三个按钮使用post请求json数据的具体对象；所有数据显示在TextView上。 <br>
4. （四）设计LoginBean文件 <br>
Bean文件的设计是根据，获得的数据来设置的，这里请求网址：<a href="http://118.192.147.148/Matchbox/useruserlogin?name=13666666666&amp;password=666666" target="_blank">http://118.192.147.148/Matchbox/useruserlogin?name=13666666666&amp;password=666666</a>  <br>
     获得的数据为：{“message”:”登陆成功”,”result”:”0”,”username”:”我的生活加减法”,”sex”:”“,”userId”:317,”url”:”\/head\/94109ed4-fc44-4592-affc-9346d4cffd36.png”,”myInfo”:”“}</p><pre data-anchor-id="yye7"><code> 在电脑输入上面的网址，就可以得到数据，一般我们程序设计也是先获得对应的json数据的字符串，分析结构后再设计Bean文件。
</code></pre><p data-anchor-id="obsh">LoginBean.Java文件代码：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="dpb5"><ol class="linenums"><li class="L0"><code><span class="kwd">package</span><span class="pln"> mydemo</span><span class="pun">;</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="com">/**</span></code></li><li class="L3"><code><span class="com"> * 登陆时的返回基本数据</span></code></li><li class="L4"><code><span class="com"> */</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">LoginBean</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> message</span><span class="pun">;</span></code></li><li class="L9"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> result</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">;</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> sex</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> userId</span><span class="pun">;</span></code></li><li class="L3"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> url</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">private</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> myInfo</span><span class="pun">;</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getMessage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> message</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setMessage</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> message</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">message </span><span class="pun">=</span><span class="pln"> message</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getResult</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> result</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setResult</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> result</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">result </span><span class="pun">=</span><span class="pln"> result</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getUsername</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> username</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setUsername</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> username</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">username </span><span class="pun">=</span><span class="pln"> username</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getSex</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> sex</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setSex</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> sex</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">sex </span><span class="pun">=</span><span class="pln"> sex</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> getUserId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> userId</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setUserId</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> userId</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">userId </span><span class="pun">=</span><span class="pln"> userId</span><span class="pun">;</span></code></li><li class="L4"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getUrl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> url</span><span class="pun">;</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setUrl</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> url</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">url </span><span class="pun">=</span><span class="pln"> url</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> getMyInfo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> myInfo</span><span class="pun">;</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> setMyInfo</span><span class="pun">(</span><span class="typ">String</span><span class="pln"> myInfo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">myInfo </span><span class="pun">=</span><span class="pln"> myInfo</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pun">}</span></code></li></ol></pre><ol data-anchor-id="2hvs">
<li>（五）设计服务接口，这是Retrofit特殊的地方：每一个服务请求要写一个接口类 <br>
1.第一个按钮的请求接口定义</li>
</ol><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="kqti"><ol class="linenums"><li class="L0"><code><span class="kwd">package</span><span class="pln"> mydemo</span><span class="pun">;</span></code></li><li class="L1"><code></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="typ">Call</span><span class="pun">;</span></code></li><li class="L4"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="pln">http</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">;</span></code></li><li class="L5"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="pln">http</span><span class="pun">.</span><span class="typ">FormUrlEncoded</span><span class="pun">;</span></code></li><li class="L6"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="pln">http</span><span class="pun">.</span><span class="pln">GET</span><span class="pun">;</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="com">/**</span></code></li><li class="L9"><code><span class="com"> * 登陆服务器的请求</span></code></li><li class="L0"><code><span class="com"> * 这里使用get请求的方式请求数据</span></code></li><li class="L1"><code><span class="com"> * 并且到的是字符串数据</span></code></li><li class="L2"><code><span class="com"> */</span></code></li><li class="L3"><code><span class="kwd">interface</span><span class="pln"> </span><span class="typ">LoginService</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">    </span><span class="lit">@GET</span><span class="pun">(</span><span class="str">"useruserlogin"</span><span class="pun">)</span><span class="com">//get请求方式</span></code></li><li class="L5"><code><span class="pln">    </span><span class="lit">@FormUrlEncoded</span><span class="pln">      </span><span class="com">//键值对的定义和数据的返回类型的定义这里是String</span></code></li><li class="L6"><code><span class="pln">    </span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> login</span><span class="pun">(</span><span class="lit">@Field</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@Field</span><span class="pun">(</span><span class="str">"password"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> password</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="02a7">2.第二个按钮的请求接口定义</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="e0br"><ol class="linenums"><li class="L0"><code><span class="kwd">package</span><span class="pln"> mydemo</span><span class="pun">;</span></code></li><li class="L1"><code></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="typ">Call</span><span class="pun">;</span></code></li><li class="L4"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="pln">http</span><span class="pun">.</span><span class="typ">Field</span><span class="pun">;</span></code></li><li class="L5"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="pln">http</span><span class="pun">.</span><span class="typ">FormUrlEncoded</span><span class="pun">;</span></code></li><li class="L6"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="pln">http</span><span class="pun">.</span><span class="pln">POST</span><span class="pun">;</span></code></li><li class="L7"><code><span class="com">/**</span></code></li><li class="L8"><code><span class="com"> 1. 登陆服务器的请求</span></code></li><li class="L9"><code><span class="com"> 2. 这里使用post请求的方式请求数据</span></code></li><li class="L0"><code><span class="com"> 3. 并且到的是字符串数据</span></code></li><li class="L1"><code><span class="com"> */</span></code></li><li class="L2"><code><span class="kwd">interface</span><span class="pln"> </span><span class="typ">LoginService2</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="lit">@POST</span><span class="pun">(</span><span class="str">"useruserlogin"</span><span class="pun">)</span><span class="com">//post请求方式</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="lit">@FormUrlEncoded</span><span class="com">//键值对的定义和数据的返回类型的定义这里是String</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> login</span><span class="pun">(</span><span class="lit">@Field</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@Field</span><span class="pun">(</span><span class="str">"password"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> password</span><span class="pun">);</span></code></li><li class="L9"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="vcog">3.第三个按钮的请求接口定义</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="rsh2"><ol class="linenums"><li class="L0"><code><span class="com">/**</span></code></li><li class="L1"><code><span class="com"> 4. 登陆服务器的请求</span></code></li><li class="L2"><code><span class="com"> 5. 这里使用post请求的方式请求数据</span></code></li><li class="L3"><code><span class="com"> 6. 并且到的是对象数据，这个用法也是比较重要的和实用的</span></code></li><li class="L4"><code><span class="com"> */</span></code></li><li class="L5"><code><span class="kwd">interface</span><span class="pln"> </span><span class="typ">LoginService3</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="lit">@POST</span><span class="pun">(</span><span class="str">"useruserlogin"</span><span class="pun">)</span><span class="com">//post请求方式，这里要获取json对象数据必须要使用post请求，可能是服务器的原因。</span></code></li><li class="L8"><code><span class="pln">    </span><span class="lit">@FormUrlEncoded</span><span class="com">//键值对的定义和数据的返回类型的定义这里是LoginBean对象数据</span></code></li><li class="L9"><code><span class="pln">    </span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">LoginBean</span><span class="pun">&gt;</span><span class="pln"> login</span><span class="pun">(</span><span class="lit">@Field</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> username</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@Field</span><span class="pun">(</span><span class="str">"password"</span><span class="pun">)</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> password</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pun">}</span></code></li></ol></pre><ol data-anchor-id="apsz">
<li>（六）主方法的类</li>
</ol><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="y2my"><ol class="linenums"><li class="L0"><code><span class="kwd">package</span><span class="pln"> mydemo</span><span class="pun">;</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="kwd">import</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">os</span><span class="pun">.</span><span class="typ">Bundle</span><span class="pun">;</span></code></li><li class="L3"><code><span class="kwd">import</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">support</span><span class="pun">.</span><span class="pln">annotation</span><span class="pun">.</span><span class="typ">Nullable</span><span class="pun">;</span></code></li><li class="L4"><code><span class="kwd">import</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">support</span><span class="pun">.</span><span class="pln">v7</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="typ">AppCompatActivity</span><span class="pun">;</span></code></li><li class="L5"><code><span class="kwd">import</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">view</span><span class="pun">.</span><span class="typ">View</span><span class="pun">;</span></code></li><li class="L6"><code><span class="kwd">import</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">widget</span><span class="pun">.</span><span class="typ">TextView</span><span class="pun">;</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="kwd">import</span><span class="pln"> fuxi</span><span class="pun">.</span><span class="pln">retrofitdemo</span><span class="pun">.</span><span class="pln">R</span><span class="pun">;</span></code></li><li class="L9"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="typ">Call</span><span class="pun">;</span></code></li><li class="L0"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="typ">Callback</span><span class="pun">;</span></code></li><li class="L1"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="typ">Response</span><span class="pun">;</span></code></li><li class="L2"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="typ">Retrofit</span><span class="pun">;</span></code></li><li class="L3"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="pln">converter</span><span class="pun">.</span><span class="pln">gson</span><span class="pun">.</span><span class="typ">GsonConverterFactory</span><span class="pun">;</span></code></li><li class="L4"><code><span class="kwd">import</span><span class="pln"> retrofit2</span><span class="pun">.</span><span class="pln">converter</span><span class="pun">.</span><span class="pln">scalars</span><span class="pun">.</span><span class="typ">ScalarsConverterFactory</span><span class="pun">;</span></code></li><li class="L5"><code></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="com">/**</span></code></li><li class="L8"><code><span class="com"> *Retrofit的使用示例</span></code></li><li class="L9"><code><span class="com"> */</span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MainClass</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AppCompatActivity</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">    </span><span class="com">//基地址</span></code></li><li class="L3"><code><span class="pln">    </span><span class="typ">String</span><span class="pln"> BASE_URL </span><span class="pun">=</span><span class="pln"> </span><span class="str">"http://118.192.147.148/Matchbox/"</span><span class="pun">;</span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">    </span><span class="typ">TextView</span><span class="pln"> tv</span><span class="pun">;</span><span class="com">//文本控件</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onCreate</span><span class="pun">(</span><span class="lit">@Nullable</span><span class="pln"> </span><span class="typ">Bundle</span><span class="pln"> savedInstanceState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onCreate</span><span class="pun">(</span><span class="pln">savedInstanceState</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">        setContentView</span><span class="pun">(</span><span class="pln">R</span><span class="pun">.</span><span class="pln">layout</span><span class="pun">.</span><span class="pln">activity_main</span><span class="pun">);</span></code></li><li class="L1"><code><span class="pln">        tv </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="typ">TextView</span><span class="pun">)</span><span class="pln"> findViewById</span><span class="pun">(</span><span class="pln">R</span><span class="pun">.</span><span class="pln">id</span><span class="pun">.</span><span class="pln">tv</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code><span class="pln">    </span><span class="com">//按钮一，get方式请求字符串数据</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> btn1</span><span class="pun">(</span><span class="typ">View</span><span class="pln"> view</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">        </span><span class="com">//获取Retrofit对象</span></code></li><li class="L6"><code><span class="pln">        </span><span class="typ">Retrofit</span><span class="pln"> retrofit </span><span class="pun">=</span><span class="pln"> getStringRetrofit</span><span class="pun">();</span></code></li><li class="L7"><code><span class="pln">        </span><span class="com">//转换成Call，在call对象包含Url的完整地址</span></code></li><li class="L8"><code><span class="pln">        </span><span class="com">//可以看到这里使用了create的方法，里面传入了请求服务的接口类</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//并且后面接的是接口类的方法，方法里面传入Url地址要的键值对的值</span></code></li><li class="L0"><code><span class="pln">        </span><span class="com">//这时call对象就有完整的Url地址，就可以请求数据了</span></code></li><li class="L1"><code><span class="pln">        </span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> retrofit</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="typ">LoginService</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">).</span><span class="pln">login</span><span class="pun">(</span><span class="str">"13666666666"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"666666"</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">//使用call对象进行网络数据请求</span></code></li><li class="L3"><code><span class="pln">        call</span><span class="pun">.</span><span class="pln">enqueue</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Callback</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">        </span><span class="com">//网络数据请求成功的回调方法</span></code></li><li class="L5"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L6"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onResponse</span><span class="pun">(</span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Response</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code><span class="pln">                </span><span class="com">//Log.e("TAG", call.request().toString());</span></code></li><li class="L8"><code><span class="pln">                tv</span><span class="pun">.</span><span class="pln">setText</span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">());</span></code></li><li class="L9"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L0"><code><span class="pln">            </span><span class="com">//网络数据请求失败的回调方法</span></code></li><li class="L1"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L2"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onFailure</span><span class="pun">(</span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Throwable</span><span class="pln"> t</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code><span class="pln">                </span><span class="com">// Toast.makeText(MainClass.this, "网络请求错误：" + t.getMessage(), Toast.LENGTH_LONG).show();</span></code></li><li class="L4"><code><span class="pln">                tv</span><span class="pun">.</span><span class="pln">setText</span><span class="pun">(</span><span class="str">"网络请求错误："</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">());</span></code></li><li class="L5"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="com">//按钮二，post方式请求字符串数据</span></code></li><li class="L1"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> btn2</span><span class="pun">(</span><span class="typ">View</span><span class="pln"> view</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">//获取Retrofit对象</span></code></li><li class="L3"><code><span class="pln">        </span><span class="typ">Retrofit</span><span class="pln"> retrofit </span><span class="pun">=</span><span class="pln"> getStringRetrofit</span><span class="pun">();</span></code></li><li class="L4"><code><span class="pln">        </span><span class="com">//转换成Call，call里面包含了Url的地址</span></code></li><li class="L5"><code><span class="pln">        </span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> retrofit</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="typ">LoginService2</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">).</span><span class="pln">login</span><span class="pun">(</span><span class="str">"13666666666"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"666666"</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">//使用call对象进行网路数据请求</span></code></li><li class="L7"><code><span class="pln">        call</span><span class="pun">.</span><span class="pln">enqueue</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Callback</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">        </span><span class="com">//网络数据请求成功时的回调方法</span></code></li><li class="L9"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L0"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onResponse</span><span class="pun">(</span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Response</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">                tv</span><span class="pun">.</span><span class="pln">setText</span><span class="pun">(</span><span class="pln">response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">toString</span><span class="pun">());</span></code></li><li class="L2"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L3"><code><span class="pln">      </span><span class="com">//网络数据请求失败时的回调方法</span></code></li><li class="L4"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L5"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onFailure</span><span class="pun">(</span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Throwable</span><span class="pln"> t</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">                tv</span><span class="pun">.</span><span class="pln">setText</span><span class="pun">(</span><span class="str">"网络请求错误："</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">());</span></code></li><li class="L7"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L3"><code><span class="com">     * 使用post的方式请求示例，并且请求json类型的数据</span></code></li><li class="L4"><code><span class="com">     */</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> btn3</span><span class="pun">(</span><span class="typ">View</span><span class="pln"> view</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">        </span><span class="com">//把网络数据传入对象中，这里使用的是GsonRetrofit </span></code></li><li class="L7"><code><span class="pln">        </span><span class="typ">Retrofit</span><span class="pln"> retrofit </span><span class="pun">=</span><span class="pln"> getGsonRetrofit</span><span class="pun">();</span></code></li><li class="L8"><code><span class="pln">        </span><span class="com">//转换成Call，call里面包含了Url地址</span></code></li><li class="L9"><code><span class="pln">        </span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">LoginBean</span><span class="pun">&gt;</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> retrofit</span><span class="pun">.</span><span class="pln">create</span><span class="pun">(</span><span class="typ">LoginService3</span><span class="pun">.</span><span class="kwd">class</span><span class="pun">).</span><span class="pln">login</span><span class="pun">(</span><span class="str">"13666666666"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"666666"</span><span class="pun">);</span></code></li><li class="L0"><code><span class="pln">        </span><span class="com">//使用call进行网络数据请求</span></code></li><li class="L1"><code><span class="pln">        call</span><span class="pun">.</span><span class="pln">enqueue</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Callback</span><span class="pun">&lt;</span><span class="typ">LoginBean</span><span class="pun">&gt;()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">//网络数据请求成功时的回调方法</span></code></li><li class="L3"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L4"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onResponse</span><span class="pun">(</span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">LoginBean</span><span class="pun">&gt;</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Response</span><span class="pun">&lt;</span><span class="typ">LoginBean</span><span class="pun">&gt;</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">            </span><span class="com">//这里可以获得Json数据里面的任意一个对象的数据</span></code></li><li class="L6"><code><span class="pln">                </span><span class="com">// Log.e("TAG", call.request().toString());</span></code></li><li class="L7"><code><span class="pln">                tv</span><span class="pun">.</span><span class="pln">setText</span><span class="pun">(</span><span class="str">"提示信息：message="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">getMessage</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span><span class="pln"> </span><span class="pun">+</span></code></li><li class="L8"><code><span class="pln">                        </span><span class="str">"返回码：result="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">getResult</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span><span class="pln"> </span><span class="pun">+</span></code></li><li class="L9"><code><span class="pln">                        </span><span class="str">"用户名username="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">getUsername</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span><span class="pln"> </span><span class="pun">+</span></code></li><li class="L0"><code><span class="pln">                        </span><span class="str">"性别sex="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">getSex</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span><span class="pln"> </span><span class="pun">+</span></code></li><li class="L1"><code><span class="pln">                        </span><span class="str">"用户的IDuserId="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">getUserId</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span><span class="pln"> </span><span class="pun">+</span></code></li><li class="L2"><code><span class="pln">                        </span><span class="str">"头像地址url="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">getUrl</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span><span class="pln"> </span><span class="pun">+</span></code></li><li class="L3"><code><span class="pln">                        </span><span class="str">"基本信息myInfo="</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="pln">getMyInfo</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"\n"</span></code></li><li class="L4"><code><span class="pln">                </span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L6"><code><span class="pln">     </span><span class="com">//网络数据请求失败时的回调方法</span></code></li><li class="L7"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L8"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onFailure</span><span class="pun">(</span><span class="typ">Call</span><span class="pun">&lt;</span><span class="typ">LoginBean</span><span class="pun">&gt;</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Throwable</span><span class="pln"> t</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">                tv</span><span class="pun">.</span><span class="pln">setText</span><span class="pun">(</span><span class="str">"网络请求错误："</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> t</span><span class="pun">.</span><span class="pln">getMessage</span><span class="pun">());</span></code></li><li class="L0"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L1"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L4"><code></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">    </span><span class="com">//返回一个Gson类型的对象</span></code></li><li class="L7"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Retrofit</span><span class="pln"> getGsonRetrofit</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">        </span><span class="typ">Retrofit</span><span class="pln"> retrofit </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Retrofit</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">().</span><span class="pln">baseUrl</span><span class="pun">(</span><span class="pln">BASE_URL</span><span class="pun">)</span></code></li><li class="L9"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">addConverterFactory</span><span class="pun">(</span><span class="typ">GsonConverterFactory</span><span class="pun">.</span><span class="pln">create</span><span class="pun">())</span></code></li><li class="L0"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></li><li class="L1"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> retrofit</span><span class="pun">;</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="com">//返回一个Gson类型的字符串,</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="typ">Retrofit</span><span class="pln"> getStringRetrofit</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">        </span><span class="typ">Retrofit</span><span class="pln"> retrofit </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Retrofit</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">().</span><span class="pln">baseUrl</span><span class="pun">(</span><span class="pln">BASE_URL</span><span class="pun">)</span></code></li><li class="L7"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">addConverterFactory</span><span class="pun">(</span><span class="typ">ScalarsConverterFactory</span><span class="pun">.</span><span class="pln">create</span><span class="pun">())</span></code></li><li class="L8"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></li><li class="L9"><code><span class="pln">        </span><span class="kwd">return</span><span class="pln"> retrofit</span><span class="pun">;</span></code></li><li class="L0"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L1"><code></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="xzpr">像没有Retrofit之前我们要获取到json数据里面的某个值，一般要经过至少两个步骤：先获取到json字符串，再通过Gson解析来获取json数据。  <br>
     而使用Retrofit结合Gson框架，可以马上就把获取到的数据转换为json数据对象。</p><ol data-anchor-id="gv0r">
<li>一般使用还会结合一下框架使用，这里做简单介绍它的依赖：</li>
</ol><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="2j2o"><ol class="linenums"><li class="L0"><code><span class="com">//Butterknifer注解框架的使用</span></code></li><li class="L1"><code><span class="pln">    compile </span><span class="str">'com.jakewharton:butterknife:8.4.0'</span></code></li><li class="L2"><code><span class="pln">    apt </span><span class="str">'com.jakewharton:butterknife-compiler:8.4.0'</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">   </span><span class="com">//加载网络框架的工具glide：加载图片的显示</span></code></li><li class="L5"><code><span class="pln">    compile </span><span class="str">'jp.wasabeef:glide-transformations:2.0.1'</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">    </span><span class="com">//加载Retrofit，用于网络数据的下载和数据的处理</span></code></li><li class="L8"><code><span class="pln">    compile </span><span class="str">'com.google.code.gson:gson:2.8.0'</span></code></li><li class="L9"><code><span class="pln">    compile </span><span class="str">'com.squareup.retrofit2:retrofit:2.1.0'</span></code></li><li class="L0"><code><span class="pln">    compile </span><span class="str">'com.squareup.okhttp3:okhttp:3.4.2'</span></code></li><li class="L1"><code><span class="pln">    compile </span><span class="str">'com.squareup.retrofit2:converter-gson:2.1.0'</span></code></li><li class="L2"><code><span class="pln">    compile </span><span class="str">'com.squareup.retrofit2:converter-scalars:2.0.0'</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln"> </span><span class="com">//加载网络框架LitePal用于数据库的操作实现</span></code></li><li class="L5"><code><span class="pln">    compile </span><span class="str">'org.litepal.android:core:1.4.1'</span></code></li></ol></pre></div>
</body>
</html>