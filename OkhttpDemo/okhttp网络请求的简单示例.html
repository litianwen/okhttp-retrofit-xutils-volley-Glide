<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>okhttp网络请求的简单示例</title>
</head>
<body>
<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="glzp" id="okhttp网络请求的简单示例">okhttp网络请求的简单示例</h1><hr><p data-anchor-id="l69j">okhttp网络请求的功能还是比较强大的。  <br>
      这里这是简单的演示：字符串数据的请求和json数据的请求。  <br>
      AndroidStudio使用Okhttp之前添加依赖就可以了：  <br>
compile ‘com.squareup.okhttp3:okhttp:3.5.0’  <br>
      GitHub中的源码地址：<a href="https://github.com/square/okhttp" target="_blank">https://github.com/square/okhttp</a>  <br>
一般要了解它的源码地址，作用，类和使用方法， 依赖的版本是会更新的。</p><p data-anchor-id="htt7">一．布局文件</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ywan"><ol class="linenums"><li class="L0"><code><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"utf-8"</span><span class="pun">?&gt;</span></code></li><li class="L1"><code><span class="tag">&lt;LinearLayout</span><span class="pln"> </span><span class="atn">xmlns:android</span><span class="pun">=</span><span class="atv">"http://schemas.android.com/apk/res/android"</span></code></li><li class="L2"><code><span class="pln">    </span><span class="atn">android:id</span><span class="pun">=</span><span class="atv">"@+id/activity_main"</span></code></li><li class="L3"><code><span class="pln">    </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"match_parent"</span></code></li><li class="L4"><code><span class="pln">    </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"match_parent"</span></code></li><li class="L5"><code><span class="pln">    </span><span class="atn">android:orientation</span><span class="pun">=</span><span class="atv">"vertical"</span></code></li><li class="L6"><code><span class="pln"> </span><span class="tag">&gt;</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pln">    </span><span class="tag">&lt;Button</span></code></li><li class="L9"><code><span class="pln">        </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"match_parent"</span></code></li><li class="L0"><code><span class="pln">        </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L1"><code><span class="pln">        </span><span class="atn">android:onClick</span><span class="pun">=</span><span class="atv">"net1"</span></code></li><li class="L2"><code><span class="pln">        </span><span class="atn">android:text</span><span class="pun">=</span><span class="atv">"get请求方法"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="tag">&lt;Button</span></code></li><li class="L5"><code><span class="pln">        </span><span class="atn">android:layout_width</span><span class="pun">=</span><span class="atv">"match_parent"</span></code></li><li class="L6"><code><span class="pln">        </span><span class="atn">android:layout_height</span><span class="pun">=</span><span class="atv">"wrap_content"</span></code></li><li class="L7"><code><span class="pln">        </span><span class="atn">android:onClick</span><span class="pun">=</span><span class="atv">"net2"</span></code></li><li class="L8"><code><span class="pln">        </span><span class="atn">android:text</span><span class="pun">=</span><span class="atv">"post键值对请求"</span><span class="pln"> </span><span class="tag">/&gt;</span></code></li><li class="L9"><code><span class="tag">&lt;/LinearLayout&gt;</span></code></li></ol></pre><pre data-anchor-id="xcia"><code>  这里设计两个按钮，第一个按钮用来请求网页的源码数据，第二个按钮用来请求ShowAPI中的json数据。
</code></pre><p data-anchor-id="awe7">二．请求数据的具体操作</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="v47p"><ol class="linenums"><li class="L0"><code><span class="kwd">package</span><span class="pln"> com</span><span class="pun">.</span><span class="pln">lwz</span><span class="pun">.</span><span class="pln">okhttp</span><span class="pun">;</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="kwd">import</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">os</span><span class="pun">.</span><span class="typ">Bundle</span><span class="pun">;</span></code></li><li class="L3"><code><span class="kwd">import</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">support</span><span class="pun">.</span><span class="pln">v7</span><span class="pun">.</span><span class="pln">app</span><span class="pun">.</span><span class="typ">AppCompatActivity</span><span class="pun">;</span></code></li><li class="L4"><code><span class="kwd">import</span><span class="pln"> android</span><span class="pun">.</span><span class="pln">view</span><span class="pun">.</span><span class="typ">View</span><span class="pun">;</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">io</span><span class="pun">.</span><span class="typ">IOException</span><span class="pun">;</span></code></li><li class="L7"><code><span class="kwd">import</span><span class="pln"> java</span><span class="pun">.</span><span class="pln">util</span><span class="pun">.</span><span class="pln">concurrent</span><span class="pun">.</span><span class="typ">TimeUnit</span><span class="pun">;</span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="kwd">import</span><span class="pln"> okhttp3</span><span class="pun">.</span><span class="typ">Call</span><span class="pun">;</span></code></li><li class="L0"><code><span class="kwd">import</span><span class="pln"> okhttp3</span><span class="pun">.</span><span class="typ">Callback</span><span class="pun">;</span></code></li><li class="L1"><code><span class="kwd">import</span><span class="pln"> okhttp3</span><span class="pun">.</span><span class="typ">FormBody</span><span class="pun">;</span></code></li><li class="L2"><code><span class="kwd">import</span><span class="pln"> okhttp3</span><span class="pun">.</span><span class="typ">OkHttpClient</span><span class="pun">;</span></code></li><li class="L3"><code><span class="kwd">import</span><span class="pln"> okhttp3</span><span class="pun">.</span><span class="typ">Request</span><span class="pun">;</span></code></li><li class="L4"><code><span class="kwd">import</span><span class="pln"> okhttp3</span><span class="pun">.</span><span class="typ">RequestBody</span><span class="pun">;</span></code></li><li class="L5"><code><span class="kwd">import</span><span class="pln"> okhttp3</span><span class="pun">.</span><span class="typ">Response</span><span class="pun">;</span></code></li><li class="L6"><code></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="com">/***</span></code></li><li class="L9"><code><span class="com"> * 演示OkHttp网络框架的使用</span></code></li><li class="L0"><code><span class="com"> * OkHttp是用于网络请求数据的一个网络框架工具</span></code></li><li class="L1"><code><span class="com"> */</span></code></li><li class="L2"><code><span class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MainActivity</span><span class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span class="typ">AppCompatActivity</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="lit">@Override</span></code></li><li class="L5"><code><span class="pln">    </span><span class="kwd">protected</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onCreate</span><span class="pun">(</span><span class="typ">Bundle</span><span class="pln"> savedInstanceState</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">        </span><span class="kwd">super</span><span class="pun">.</span><span class="pln">onCreate</span><span class="pun">(</span><span class="pln">savedInstanceState</span><span class="pun">);</span></code></li><li class="L7"><code><span class="pln">        setContentView</span><span class="pun">(</span><span class="pln">R</span><span class="pun">.</span><span class="pln">layout</span><span class="pun">.</span><span class="pln">activity_main</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L1"><code><span class="com">     * get请求方式</span></code></li><li class="L2"><code><span class="com">     * 请求百度网页的源码数据</span></code></li><li class="L3"><code><span class="com">     */</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> net1</span><span class="pun">(</span><span class="typ">View</span><span class="pln"> view</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">        </span><span class="com">//创建网络处理的对象</span></code></li><li class="L6"><code><span class="pln">        </span><span class="typ">OkHttpClient</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OkHttpClient</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">()</span></code></li><li class="L7"><code><span class="pln">                </span><span class="com">//设置读取数据的时间</span></code></li><li class="L8"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">readTimeout</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TimeUnit</span><span class="pun">.</span><span class="pln">SECONDS</span><span class="pun">)</span></code></li><li class="L9"><code><span class="pln">                </span><span class="com">//对象的创建</span></code></li><li class="L0"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></li><li class="L1"><code><span class="pln">        </span><span class="com">//创建一个网络请求的对象，如果没有写请求方式，默认的是get</span></code></li><li class="L2"><code><span class="pln">        </span><span class="com">//在请求对象里面传入链接的URL地址</span></code></li><li class="L3"><code><span class="pln">        </span><span class="typ">Request</span><span class="pln"> request </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Request</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">()</span></code></li><li class="L4"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">url</span><span class="pun">(</span><span class="str">"https://www.baidu.com"</span><span class="pun">).</span><span class="pln">build</span><span class="pun">();</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">        </span><span class="com">//call就是我们可以执行的请求类</span></code></li><li class="L7"><code><span class="pln">        </span><span class="typ">Call</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">newCall</span><span class="pun">(</span><span class="pln">request</span><span class="pun">);</span></code></li><li class="L8"><code><span class="pln">        </span><span class="com">//异步方法，来执行任务的处理，一般都是使用异步方法执行的</span></code></li><li class="L9"><code><span class="pln">        call</span><span class="pun">.</span><span class="pln">enqueue</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Callback</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L1"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onFailure</span><span class="pun">(</span><span class="typ">Call</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code><span class="pln">                </span><span class="com">//失败</span></code></li><li class="L3"><code><span class="pln">                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(“</span><span class="pln">TAG</span><span class="pun">”,</span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">currentThread</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"结果  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">());</span></code></li><li class="L4"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L7"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onResponse</span><span class="pun">(</span><span class="typ">Call</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Response</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code><span class="pln">                </span><span class="com">//成功</span></code></li><li class="L9"><code><span class="pln">                </span><span class="com">//子线程</span></code></li><li class="L0"><code><span class="pln">                </span><span class="com">//main thread1</span></code></li><li class="L1"><code><span class="pln">               </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(“</span><span class="pln">TAG</span><span class="pun">”,</span><span class="typ">Thread</span><span class="pun">.</span><span class="pln">currentThread</span><span class="pun">().</span><span class="pln">getName</span><span class="pun">()</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="str">"结果  "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="kwd">string</span><span class="pun">());</span></code></li><li class="L2"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L3"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L4"><code><span class="pln">        </span><span class="com">//  call.cancel();取消任务</span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="pln">        </span><span class="com">//同步方法,一般不用</span></code></li><li class="L7"><code><span class="pln">       </span><span class="com">/* try {</span></code></li><li class="L8"><code><span class="com">            Response execute = call.execute();</span></code></li><li class="L9"><code><span class="com">        } catch (IOException e) {</span></code></li><li class="L0"><code><span class="com">            e.printStackTrace();</span></code></li><li class="L1"><code><span class="com">        }*/</span></code></li><li class="L2"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">    </span><span class="com">/**</span></code></li><li class="L5"><code><span class="com">     * post请求方式，请求网络数据</span></code></li><li class="L6"><code><span class="com">     * 请求ShowAPI里面的json数据</span></code></li><li class="L7"><code><span class="com">     */</span></code></li><li class="L8"><code><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> net2</span><span class="pun">(</span><span class="typ">View</span><span class="pln"> view</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//创建网络处理的对象</span></code></li><li class="L0"><code><span class="pln">        </span><span class="typ">OkHttpClient</span><span class="pln"> client </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">OkHttpClient</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">()</span></code></li><li class="L1"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">readTimeout</span><span class="pun">(</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="typ">TimeUnit</span><span class="pun">.</span><span class="pln">SECONDS</span><span class="pun">)</span></code></li><li class="L2"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">build</span><span class="pun">();</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">        </span><span class="com">//post请求来获得数据</span></code></li><li class="L5"><code><span class="pln">        </span><span class="com">//创建一个RequestBody，存放重要数据的键值对</span></code></li><li class="L6"><code><span class="pln">        </span><span class="typ">RequestBody</span><span class="pln"> body </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FormBody</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">()</span></code></li><li class="L7"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">"showapi_appid"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"13074"</span><span class="pun">)</span></code></li><li class="L8"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="str">"showapi_sign"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"ea5b4bf2e140498bb772d1bf2a51a7a0"</span><span class="pun">).</span><span class="pln">build</span><span class="pun">();</span></code></li><li class="L9"><code><span class="pln">        </span><span class="com">//创建一个请求对象，传入URL地址和相关数据的键值对的对象</span></code></li><li class="L0"><code><span class="pln">        </span><span class="typ">Request</span><span class="pln"> request </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Request</span><span class="pun">.</span><span class="typ">Builder</span><span class="pun">()</span></code></li><li class="L1"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">url</span><span class="pun">(</span><span class="str">"http://route.showapi.com/341-3"</span><span class="pun">)</span></code></li><li class="L2"><code><span class="pln">                </span><span class="pun">.</span><span class="pln">post</span><span class="pun">(</span><span class="pln">body</span><span class="pun">).</span><span class="pln">build</span><span class="pun">();</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">        </span><span class="com">//创建一个能处理请求数据的操作类</span></code></li><li class="L5"><code><span class="pln">        </span><span class="typ">Call</span><span class="pln"> call </span><span class="pun">=</span><span class="pln"> client</span><span class="pun">.</span><span class="pln">newCall</span><span class="pun">(</span><span class="pln">request</span><span class="pun">);</span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">        </span><span class="com">//使用异步任务的模式请求数据</span></code></li><li class="L8"><code><span class="pln">        call</span><span class="pun">.</span><span class="pln">enqueue</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Callback</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L0"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onFailure</span><span class="pun">(</span><span class="typ">Call</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">                </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(“</span><span class="pln">TAG</span><span class="pun">”,</span><span class="str">"错误信息："</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">());</span></code></li><li class="L2"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">            </span><span class="lit">@Override</span></code></li><li class="L5"><code><span class="pln">            </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> onResponse</span><span class="pun">(</span><span class="typ">Call</span><span class="pln"> call</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Response</span><span class="pln"> response</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code><span class="pln">               </span><span class="typ">Log</span><span class="pun">.</span><span class="pln">e</span><span class="pun">(“</span><span class="pln">TAG</span><span class="pun">”,</span><span class="pln">response</span><span class="pun">.</span><span class="pln">body</span><span class="pun">().</span><span class="kwd">string</span><span class="pun">());</span></code></li><li class="L7"><code><span class="pln">            </span><span class="pun">}</span></code></li><li class="L8"><code><span class="pln">        </span><span class="pun">});</span></code></li><li class="L9"><code><span class="pln">    </span><span class="pun">}</span></code></li><li class="L0"><code></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="pun">}</span></code></li></ol></pre></div>
</body>
</html>